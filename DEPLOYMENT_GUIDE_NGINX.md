# YIXINå‰ç«¯éƒ¨ç½²æŒ‡å— - Nginxæ–¹æ¡ˆ

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

**éƒ¨ç½²æ¶æ„:** Nginx + Node.jsï¼ˆåŒä¸€æœåŠ¡å™¨ï¼‰
**æœåŠ¡å™¨:** é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨ 8.148.73.181
**åŸŸå:** yixinaipsy.com
**é¢„è®¡æ—¶é—´:** 30-45åˆ†é’Ÿ

---

## âœ… å‡†å¤‡å·¥ä½œ

### æœ¬åœ°æ–‡ä»¶æ£€æŸ¥

1. **å‰ç«¯æ„å»ºæ–‡ä»¶** - ç¡®è®¤ `F:\YIXIN_PROJECT\dist\` æ–‡ä»¶å¤¹å­˜åœ¨
2. **éƒ¨ç½²è„šæœ¬** - `F:\YIXIN_PROJECT\deploy-frontend.sh`
3. **Nginxé…ç½®** - `F:\YIXIN_PROJECT\nginx-yixin.conf`

### æœåŠ¡å™¨ä¿¡æ¯

- **å…¬ç½‘IP:** 8.148.73.181
- **ç”¨æˆ·å:** admin
- **éƒ¨ç½²ç›®å½•:** /home/admin/yixin
- **è¿æ¥æ–¹å¼:** é˜¿é‡Œäº‘Workbench æˆ– SSH

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬1æ­¥: è¿æ¥åˆ°æœåŠ¡å™¨

**æ–¹å¼1: é˜¿é‡Œäº‘Workbenchï¼ˆæ¨èï¼‰**
```
1. è®¿é—®: https://swas.console.aliyun.com/
2. æ‰¾åˆ°æ‚¨çš„å®ä¾‹ï¼ˆ8.148.73.181ï¼‰
3. ç‚¹å‡»"è¿œç¨‹è¿æ¥" â†’ "Workbench"
4. ç­‰å¾…è¿æ¥æˆåŠŸ
```

**æ–¹å¼2: SSHå®¢æˆ·ç«¯**
```bash
ssh admin@8.148.73.181
```

---

### ç¬¬2æ­¥: ä¸Šä¼ å¹¶æ‰§è¡Œéƒ¨ç½²è„šæœ¬

#### 2.1 ä¸Šä¼ éƒ¨ç½²è„šæœ¬

**ä½¿ç”¨Workbenchä¸Šä¼ :**
```bash
# åœ¨æœ¬åœ°æ‰“å¼€PowerShellæˆ–CMDï¼Œæ‰§è¡Œï¼š
scp F:\YIXIN_PROJECT\deploy-frontend.sh admin@8.148.73.181:/home/admin/
```

**æˆ–è€…åœ¨Workbenchä¸­ç›´æ¥åˆ›å»ºæ–‡ä»¶:**
```bash
# è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œæ‰§è¡Œï¼š
cd /home/admin
vi deploy-frontend.sh
# æŒ‰ i è¿›å…¥ç¼–è¾‘æ¨¡å¼
# ç²˜è´´ deploy-frontend.sh çš„å†…å®¹
# æŒ‰ ESCï¼Œè¾“å…¥ :wq ä¿å­˜é€€å‡º
```

#### 2.2 æ‰§è¡Œéƒ¨ç½²è„šæœ¬

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy-frontend.sh

# æ‰§è¡Œè„šæœ¬
./deploy-frontend.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ:**
- âœ… å®‰è£…Nginx
- âœ… åˆ›å»ºå‰ç«¯ç›®å½•
- âœ… é…ç½®Nginx
- âœ… æµ‹è¯•é…ç½®
- âœ… å¯åŠ¨æœåŠ¡

---

### ç¬¬3æ­¥: ä¸Šä¼ å‰ç«¯æ–‡ä»¶

#### æ–¹å¼1: ä½¿ç”¨SCPï¼ˆæ¨èï¼‰

**åœ¨æœ¬åœ°Windows PowerShellä¸­æ‰§è¡Œ:**

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd F:\YIXIN_PROJECT

# ä¸Šä¼ æ•´ä¸ªdistæ–‡ä»¶å¤¹
scp -r dist/* admin@8.148.73.181:/home/admin/yixin/frontend/
```

**ç­‰å¾…ä¸Šä¼ å®Œæˆï¼Œå¯èƒ½éœ€è¦1-3åˆ†é’Ÿã€‚**

#### æ–¹å¼2: ä½¿ç”¨WinSCPå›¾å½¢ç•Œé¢

1. ä¸‹è½½å¹¶å®‰è£… WinSCP: https://winscp.net/
2. æ–°å»ºè¿æ¥:
   - ä¸»æœº: 8.148.73.181
   - ç”¨æˆ·å: admin
   - å¯†ç : ï¼ˆæ‚¨çš„æœåŠ¡å™¨å¯†ç ï¼‰
3. è¿æ¥æˆåŠŸå:
   - å·¦ä¾§: æœ¬åœ° `F:\YIXIN_PROJECT\dist\`
   - å³ä¾§: æœåŠ¡å™¨ `/home/admin/yixin/frontend/`
4. é€‰ä¸­distæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ‹–æ‹½åˆ°å³ä¾§
5. ç­‰å¾…ä¸Šä¼ å®Œæˆ

#### æ–¹å¼3: ä½¿ç”¨é˜¿é‡Œäº‘Workbenchä¸Šä¼ ï¼ˆå°æ–‡ä»¶ï¼‰

```bash
# åœ¨æœåŠ¡å™¨ä¸Šï¼Œåˆ›å»ºä¸´æ—¶ç›®å½•
cd /home/admin
mkdir temp_upload

# ä½¿ç”¨Workbenchçš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
# ä¸Šä¼ å•ä¸ªæ–‡ä»¶åˆ° temp_upload

# ç„¶åç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®
mv temp_upload/* /home/admin/yixin/frontend/
```

---

### ç¬¬4æ­¥: éªŒè¯æ–‡ä»¶ä¸Šä¼ 

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ:

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh /home/admin/yixin/frontend/

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# index.html
# assets/
#   â”œâ”€â”€ index-xxxxx.js
#   â”œâ”€â”€ index-xxxxx.css
#   â””â”€â”€ ...
```

---

### ç¬¬5æ­¥: é…ç½®é˜²ç«å¢™ï¼ˆé˜¿é‡Œäº‘æ§åˆ¶å°ï¼‰

1. è®¿é—®: https://swas.console.aliyun.com/
2. ç‚¹å‡»æ‚¨çš„å®ä¾‹
3. å·¦ä¾§èœå• â†’ "å®‰å…¨" â†’ "é˜²ç«å¢™"
4. ç¡®ä¿å·²æ·»åŠ ä»¥ä¸‹è§„åˆ™:

| ç«¯å£èŒƒå›´ | åè®® | ç­–ç•¥ | è¯´æ˜ |
|---------|------|------|------|
| 80 | TCP | å…è®¸ | HTTP |
| 443 | TCP | å…è®¸ | HTTPS |
| 3000 | TCP | å…è®¸ | åç«¯API |

**å¦‚æœæ²¡æœ‰ï¼Œç‚¹å‡»"æ·»åŠ è§„åˆ™"æ·»åŠ ã€‚**

---

### ç¬¬6æ­¥: é…ç½®DNSè§£æ

1. ç™»å½•é˜¿é‡Œäº‘DNSæ§åˆ¶å°: https://dns.console.aliyun.com/
2. æ‰¾åˆ°åŸŸå `yixinaipsy.com`
3. ç‚¹å‡»"è§£æè®¾ç½®"
4. æ·»åŠ /ä¿®æ”¹ä»¥ä¸‹è®°å½•:

**ä¸»åŸŸå (@):**
```
è®°å½•ç±»å‹: A
ä¸»æœºè®°å½•: @
è§£æçº¿è·¯: é»˜è®¤
è®°å½•å€¼: 8.148.73.181
TTL: 10åˆ†é’Ÿ
```

**wwwå­åŸŸå:**
```
è®°å½•ç±»å‹: A
ä¸»æœºè®°å½•: www
è§£æçº¿è·¯: é»˜è®¤
è®°å½•å€¼: 8.148.73.181
TTL: 10åˆ†é’Ÿ
```

5. ç‚¹å‡»"ç¡®å®š"ä¿å­˜

**DNSç”Ÿæ•ˆæ—¶é—´: 5-15åˆ†é’Ÿ**

---

### ç¬¬7æ­¥: æµ‹è¯•è®¿é—®

#### 7.1 ç­‰å¾…DNSç”Ÿæ•ˆ

```bash
# åœ¨æœ¬åœ°CMDæˆ–PowerShellä¸­æ‰§è¡Œ
nslookup yixinaipsy.com

# åº”è¯¥çœ‹åˆ°:
# Address: 8.148.73.181
```

#### 7.2 è®¿é—®ç½‘ç«™

æµè§ˆå™¨è®¿é—®:
```
http://yixinaipsy.com
æˆ–
http://8.148.73.181
```

**æœŸæœ›ç»“æœ:**
- âœ… çœ‹åˆ°YIXINç™»å½•/æ³¨å†Œé¡µé¢
- âœ… é¡µé¢æ ·å¼æ­£å¸¸æ˜¾ç¤º
- âœ… å¯ä»¥æ­£å¸¸å¯¼èˆªåˆ°å„ä¸ªé¡µé¢

#### 7.3 æµ‹è¯•APIè¿æ¥

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. å°è¯•ç™»å½•æˆ–æ³¨å†Œ
4. æ£€æŸ¥ `/api/auth/login` ç­‰è¯·æ±‚æ˜¯å¦æˆåŠŸ

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æ— æ³•è®¿é—®ç½‘ç«™ï¼ˆ404ï¼‰

**æ£€æŸ¥:**
```bash
# 1. ç¡®è®¤Nginxè¿è¡Œ
sudo systemctl status nginx

# 2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -l /home/admin/yixin/frontend/index.html

# 3. æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -20 /var/log/nginx/yixin_error.log
```

**è§£å†³:**
```bash
# é‡å¯Nginx
sudo systemctl restart nginx
```

---

### é—®é¢˜2: APIè¯·æ±‚å¤±è´¥ï¼ˆ502 Bad Gatewayï¼‰

**æ£€æŸ¥åç«¯æœåŠ¡:**
```bash
# æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
pm2 status

# åº”è¯¥çœ‹åˆ° YixinBackend: online
```

**æ£€æŸ¥ç«¯å£:**
```bash
# æµ‹è¯•åç«¯API
curl http://localhost:3000/api/health

# åº”è¯¥è¿”å›: {"success":true,"message":"ok"}
```

---

### é—®é¢˜3: é¡µé¢æ ·å¼ä¸æ˜¾ç¤º

**æ£€æŸ¥é™æ€èµ„æºè·¯å¾„:**
```bash
# æŸ¥çœ‹assetsç›®å½•
ls -l /home/admin/yixin/frontend/assets/

# æ£€æŸ¥Nginxè®¿é—®æ—¥å¿—
sudo tail -20 /var/log/nginx/yixin_access.log
```

**è§£å†³:**
```bash
# ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
sudo chown -R admin:admin /home/admin/yixin/frontend
sudo chmod -R 755 /home/admin/yixin/frontend
```

---

### é—®é¢˜4: åˆ·æ–°é¡µé¢404

**åŸå› :** SPAè·¯ç”±é—®é¢˜

**æ£€æŸ¥Nginxé…ç½®:**
```bash
# æŸ¥çœ‹é…ç½®
cat /etc/nginx/conf.d/yixin.conf | grep try_files

# åº”è¯¥åŒ…å«: try_files $uri $uri/ /index.html;
```

---

## ğŸ¯ åç»­ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

### é…ç½®HTTPS

1. å®‰è£…Certbot:
```bash
sudo yum install -y certbot python3-certbot-nginx
```

2. è‡ªåŠ¨ç”³è¯·SSLè¯ä¹¦:
```bash
sudo certbot --nginx -d yixinaipsy.com -d www.yixinaipsy.com
```

3. è‡ªåŠ¨ç»­æœŸ:
```bash
sudo certbot renew --dry-run
```

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹NginxçŠ¶æ€
sudo systemctl status nginx

# é‡å¯Nginx
sudo systemctl restart nginx

# é‡è½½Nginxé…ç½®ï¼ˆæ— éœ€åœæœºï¼‰
sudo nginx -s reload

# æµ‹è¯•Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/yixin_access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/yixin_error.log

# æŸ¥çœ‹åç«¯æœåŠ¡
pm2 status
pm2 logs YixinBackend

# æµ‹è¯•åç«¯API
curl http://localhost:3000/api/health
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] Nginxå®‰è£…å¹¶è¿è¡Œ
- [ ] å‰ç«¯æ–‡ä»¶å·²ä¸Šä¼ åˆ° `/home/admin/yixin/frontend/`
- [ ] Nginxé…ç½®æ–‡ä»¶åˆ›å»ºå¹¶æµ‹è¯•é€šè¿‡
- [ ] é˜²ç«å¢™å·²å¼€æ”¾80ã€443ç«¯å£
- [ ] DNSè§£æå·²é…ç½®å¹¶ç”Ÿæ•ˆ
- [ ] å¯ä»¥é€šè¿‡åŸŸåè®¿é—®ç½‘ç«™
- [ ] å‰ç«¯é¡µé¢æ ·å¼æ­£å¸¸
- [ ] APIè¯·æ±‚æˆåŠŸ
- [ ] è·¯ç”±è·³è½¬æ­£å¸¸
- [ ] ï¼ˆå¯é€‰ï¼‰HTTPSé…ç½®å®Œæˆ

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

å½“æ‚¨å¯ä»¥:
1. âœ… è®¿é—® `http://yixinaipsy.com` çœ‹åˆ°ç™»å½•é¡µ
2. âœ… æˆåŠŸæ³¨å†Œ/ç™»å½•
3. âœ… åˆ›å»ºä¼šè¯å¹¶ä¸AIå¯¹è¯
4. âœ… è¯­éŸ³åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**æ­å–œï¼éƒ¨ç½²æˆåŠŸï¼** ğŸŠ

---

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·:
1. æŸ¥çœ‹ä¸Šè¿°"å¸¸è§é—®é¢˜æ’æŸ¥"ç« èŠ‚
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. å°†é”™è¯¯ä¿¡æ¯æä¾›ç»™æˆ‘

---

**åˆ›å»ºæ—¶é—´:** 2025-10-26
**æ›´æ–°æ—¶é—´:** 2025-10-26
**éƒ¨ç½²æ–¹æ¡ˆ:** Nginxç›´æ¥éƒ¨ç½²
**é¢„è®¡å®Œæˆ:** 30-45åˆ†é’Ÿ
